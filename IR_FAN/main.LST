C51 COMPILER V9.01   MAIN                                                                  05/25/2019 17:31:13 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg52.h>
   2          
   3          sbit IR=P3^2;
   4          sbit DU=P2^0;
   5          sbit WE=P2^1;
   6          sbit mada=P3^1;
   7          sbit led88=P2^2;
   8          
   9          
  10          unsigned char code DuanMa[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  11          unsigned char code fz[8]={0xfe,0xfc,0xfd,0xf9,0xfb,0xf3,0xf7,0xf6};
  12          unsigned char code zz[8]={0xf6,0xf7,0xf3,0xfb,0xf9,0xfd,0xfc,0xfe};
  13          
  14          
  15          
  16          unsigned char  irtime;
  17          bit irpro_ok,irok;
  18          unsigned char IRcord[4];
  19          unsigned char irdata[33];
  20          
  21          unsigned int zl_count=0;
  22          unsigned int bj_flag=0;
  23          unsigned char pwm;
  24          unsigned int  time=0;
  25          
  26          
  27          void Ir_work(void);
  28          void Ircordpro(void);
  29          void bjdj();
  30          void delay(unsigned int xms);
  31          
  32          void delay(unsigned int xms)
  33          {
  34   1          unsigned int x,y;
  35   1          for(x=xms;x>0;x--)
  36   1              for(y=110;y>0;y--);
  37   1      }
  38          
  39          void tim0_isr (void) interrupt 1
  40          {
  41   1        irtime++;
  42   1      }
  43          
  44          
  45          
  46          
  47          void mada_con() interrupt 3{
  48   1              if(time==14000)time=0;
  49   1              TH1=(65536-1000)/256;
  50   1              TL1=(65536-1000)%256;
  51   1              zl_count++;
  52   1              time++;
  53   1              if(zl_count==pwm){
  54   2                      mada=0;
  55   2              }
C51 COMPILER V9.01   MAIN                                                                  05/25/2019 17:31:13 PAGE 2   

  56   1              
  57   1              if(zl_count==10){
  58   2                      mada=1;
  59   2                      zl_count=0;
  60   2              }
  61   1      }
  62          
  63          
  64          
  65          
  66          
  67          
  68          void EX0_ISR (void) interrupt 0 
  69          {
  70   1        static unsigned char  i;             //接收红外信号处理
  71   1        static bit startflag;                //是否开始处理标志位
  72   1      
  73   1      if(startflag)                         
  74   1         {
  75   2              if(irtime<63&&irtime>=32)//引导码 TC9012的头码，9ms+4.5ms
  76   2                                                      i=0;
  77   2                              irdata[i]=irtime;//存储每个电平的持续时间，用于以后判断是0还是1
  78   2                              irtime=0;
  79   2                              i++;
  80   2                               if(i==33)
  81   2                                      {
  82   3                                       irok=1;
  83   3                                       i=0;
  84   3                                      }
  85   2              }
  86   1               else
  87   1                      {
  88   2                      irtime=0;
  89   2                      startflag=1;
  90   2                      }
  91   1      }
  92          
  93          
  94          void TIM0init(void)
  95          {
  96   1      
  97   1              TH0=0x00;
  98   1              TL0=0x00;
  99   1              ET0=1;
 100   1              TR0=1;    
 101   1      }
 102          
 103          void TIM1init(void)
 104          {
 105   1              TMOD=0x12;
 106   1              TH1=(65536-1000)/256;
 107   1              TL1=(65536-1000)%256;
 108   1              pwm=0;
 109   1              mada=0;
 110   1              ET1=1;
 111   1              TR1=0;
 112   1      
 113   1      }
 114          
 115          
 116          
 117          void EX0init(void)
C51 COMPILER V9.01   MAIN                                                                  05/25/2019 17:31:13 PAGE 3   

 118          {
 119   1       IT0 = 1;
 120   1       EX0 = 1;
 121   1       EA = 1;
 122   1      }
 123          
 124          
 125          void Ir_work(void)
 126          {
 127   1              switch(IRcord[2])
 128   1                   {
 129   2                       case 0x45:
 130   2                                      pwm=2;
 131   2                                      TR1=1;
 132   2                                      mada=1;
 133   2                                      P0=DuanMa[1];
 134   2                               break;
 135   2                       
 136   2                       
 137   2                       case 0x0c:
 138   2              
 139   2                                      P0=DuanMa[1];
 140   2                                      pwm=2;
 141   2                      
 142   2                               
 143   2                               break;
 144   2      
 145   2                       case 0x18:
 146   2                      
 147   2                                      P0=DuanMa[2];
 148   2                                      pwm=5;  
 149   2      
 150   2                               
 151   2                               break;
 152   2                      
 153   2                       case 0x5e:
 154   2                              
 155   2                                      P0=DuanMa[3];
 156   2                                      pwm=0;  
 157   2                      
 158   2                               
 159   2                               break;
 160   2      
 161   2                       case 0x08:
 162   2                              
 163   2                                      bj_flag=~bj_flag;       
 164   2                               
 165   2                               
 166   2                               break;
 167   2      
 168   2                   default:
 169   2                              break;
 170   2                       }
 171   1                irpro_ok=0;
 172   1      
 173   1      }
 174          
 175          void Ircordpro(void)
 176          { 
 177   1              unsigned char i, j, k;
 178   1              unsigned char cord,value;
 179   1              
C51 COMPILER V9.01   MAIN                                                                  05/25/2019 17:31:13 PAGE 4   

 180   1              k=1;
 181   1              for(i=0;i<4;i++)      //处理4个字节
 182   1               {
 183   2                for(j=1;j<=8;j++) //处理1个字节8位
 184   2                   {
 185   3                    cord=irdata[k];
 186   3                    if(cord>7)//大于某值为1，这个和晶振有绝对关系，这里使用12M计算，此值可以有一定误差
 187   3                       value|=0x80;
 188   3                    if(j<8)
 189   3                          {
 190   4                               value>>=1;
 191   4                              }
 192   3                     k++;
 193   3                   }
 194   2               IRcord[i]=value;
 195   2               value=0;     
 196   2               } 
 197   1               irpro_ok=1;
 198   1      }
 199          
 200          
 201          void bjdj(){
 202   1              unsigned int i=0;
 203   1              if(bj_flag)
 204   1              {
 205   2                      if(time<5000)
 206   2                      {
 207   3                              for(i=0;i<7;i++)
 208   3                              {
 209   4                                      P1=zz[i];
 210   4                                      delay(5);
 211   4                              }
 212   3                      }
 213   2                      
 214   2                      if(time>=5000 && time<7000)
 215   2                      {
 216   3                              P1=0x0;
 217   3                      }
 218   2                      
 219   2                      if(time>=7000 && time<12000)
 220   2                      {
 221   3                              for(i=0;i<7;i++)
 222   3                              {
 223   4                                      P1=fz[i];
 224   4                                      delay(5);
 225   4                              }
 226   3                      }
 227   2                      
 228   2                      if(time>=12000 && time<14000)
 229   2                      {
 230   3                              P1=0x0;
 231   3                      }
 232   2              }       
 233   1      }
 234          
 235          
 236          
 237          
 238          void main()
 239          {
 240   1              EX0init();
 241   1              TIM0init();
C51 COMPILER V9.01   MAIN                                                                  05/25/2019 17:31:13 PAGE 5   

 242   1              TIM1init();
 243   1              led88=0;
 244   1              P0=0xfe;
 245   1              WE=0;
 246   1              P0=0x0;
 247   1              bj_flag=0;
 248   1       while(1)
 249   1         {
 250   2              bjdj();
 251   2              if(irok)
 252   2                {   
 253   3                 Ircordpro();
 254   3                 irok=0;
 255   3                }
 256   2      
 257   2          if(irpro_ok)
 258   2                {
 259   3                 Ir_work();
 260   3                }
 261   2         }
 262   1      }
 263            
 264            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    515    ----
   CONSTANT SIZE    =     26    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     46    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
